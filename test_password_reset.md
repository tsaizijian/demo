# 密碼重置功能測試指南

## 🎯 已實現的功能

### 後端 API
1. **密碼重置 API**: `POST /api/v1/channelmemberapi/channel/{id}/reset-password`
   - 權限：僅限 owner 和 admin
   - 功能：重置頻道密碼並返回新密碼明文

2. **管理員資訊 API**: `GET /api/v1/channelmemberapi/channel/{id}/info`
   - 權限：僅限 owner 和 admin
   - 功能：獲取頻道詳細資訊和管理員列表

### 前端界面
1. **頻道設定對話框擴展**
   - 顯示管理團隊列表（owner/admin）
   - 密碼重置按鈕（僅限 owner/admin 可見）
   - 管理員角色標識

2. **密碼重置對話框**
   - 新密碼輸入
   - 安全警告訊息
   - 自動複製新密碼到剪貼板

## 🧪 測試步驟

### 1. 創建測試環境
```bash
# 確保依賴已安裝
cd backend
pip install flask-bcrypt

# 執行遷移（如果還未執行）
python migrate_channel_members.py

# 重啟後端
python run.py

# 重啟前端
cd ../frontend
pnpm dev
```

### 2. 創建測試頻道
1. 以用戶 A 身份登入
2. 創建私人頻道
3. 啟用「允許通過頻道ID加入」
4. 啟用「需要密碼才能加入」
5. 設定初始密碼（例如：test123）

### 3. 添加管理員
1. 以用戶 B 身份加入頻道（使用ID + 密碼）
2. 以用戶 A（owner）身份將用戶 B 設為管理員

### 4. 測試密碼查看權限

#### Owner 權限測試：
1. 以用戶 A（owner）身份開啟頻道設定
2. ✅ 應該看到「管理團隊」區塊
3. ✅ 應該看到所有 owner/admin 列表
4. ✅ 密碼區塊應該顯示「重置密碼」按鈕

#### Admin 權限測試：
1. 以用戶 B（admin）身份開啟頻道設定
2. ✅ 應該看到「管理團隊」區塊
3. ✅ 應該看到所有 owner/admin 列表
4. ✅ 密碼區塊應該顯示「重置密碼」按鈕

#### Member 權限測試：
1. 以普通成員身份開啟頻道設定
2. ❌ 不應該看到「管理團隊」區塊
3. ❌ 不應該看到「重置密碼」按鈕

### 5. 測試密碼重置功能

#### 成功重置：
1. 以 owner/admin 身份點擊「重置密碼」
2. 輸入新密碼（至少6位）
3. 點擊「重置密碼」
4. ✅ 應該顯示成功訊息
5. ✅ 新密碼應該自動複製到剪貼板
6. ✅ Toast 應該顯示新密碼（10秒）

#### 驗證新密碼：
1. 以另一個用戶嘗試用舊密碼加入
2. ❌ 應該顯示「密碼錯誤」
3. 以新密碼加入
4. ✅ 應該成功加入

### 6. 測試錯誤情況

#### 權限不足：
1. 以普通成員身份直接調用 API
2. ❌ 應該返回 403 權限不足

#### 密碼長度不足：
1. 以 owner/admin 身份重置密碼
2. 輸入少於6位的密碼
3. ❌ 應該顯示驗證錯誤

## 📋 驗收標準

### ✅ 必須通過的測試：
- [ ] Owner 可以查看管理團隊和重置密碼
- [ ] Admin 可以查看管理團隊和重置密碼  
- [ ] Member 不能查看管理資訊和重置密碼
- [ ] 密碼重置後舊密碼失效
- [ ] 新密碼能正常使用
- [ ] 密碼自動複製到剪貼板
- [ ] UI 顯示正確的角色標識
- [ ] 錯誤處理正確（權限、密碼長度等）

### 🔒 安全驗證：
- [ ] API 權限檢查正確
- [ ] 新密碼使用 bcrypt 加密存儲
- [ ] 舊密碼確實失效
- [ ] 無法繞過權限限制

## 🐛 已知問題與解決

### 問題1：創建者忘記密碼
**解決**：Owner 和 Admin 都可以重置密碼，確保總有人能管理

### 問題2：不知道誰是管理員
**解決**：頻道設定顯示完整的管理團隊列表

### 問題3：密碼重置後通知問題
**解決**：新密碼會顯示在 Toast 中並自動複製到剪貼板

## 🚀 部署清單

重置密碼功能已經完成實作，包含：
- ✅ 後端 API 實作
- ✅ 前端 UI 實作  
- ✅ 權限控制
- ✅ 安全加密
- ✅ 錯誤處理

可以開始測試部署！